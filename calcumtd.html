<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Latihan Acak Pohon</title>
    <style>
      :root {
        --bg: #f6f8fb;
        --card: #fff;
        --accent: #2563eb;
        --muted: #6b7280;
      }

      body {
        margin: 0;
        font-family: Inter, system-ui, Arial;
        background: var(--bg);
      }

      header {
        background: linear-gradient(90deg, #0ea5e9, #6366f1);
        color: #fff;
        padding: 16px;
        text-align: center;
      }

      .container {
        display: grid;
        grid-template-columns: 360px 1fr;
        gap: 16px;
        padding: 16px;
      }

      .panel {
        background: var(--card);
        padding: 14px;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
      }
      textarea,
      input,
      select {
        width: 100%;
        padding: 6px;
        border: 1px solid #000;
        border-radius: 6px;
        margin-bottom: 6px;
      }

      .btn {
        padding: 8px 12px;
        background: var(--accent);
        color: #fff;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        margin-top: 6px;
      }

      .btn.secondary {
        background: #10b981;
      }

      .soalBox {
        margin-top: 10px;
        padding: 10px;
        background: #eff6ff;
        border-left: 4px solid var(--accent);
        border-radius: 6px;
      }

      .result {
        font-weight: bold;
        margin-left: 8px;
      }
      .true {
        color: green;
      }
      .false {
        color: red;
      }
      .jawabanBenar {
        margin-top: 6px;
        font-weight: 600;
        color: #6b21a8;
      }

      #svgWrap {
        height: 60vh;
        border: 1px dashed #e2e8f0;
        border-radius: 10px;
        background: #fff;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      svg {
        width: 100%;
        height: 100%;
      }
      footer {
        text-align: center;
        font-size: 13px;
        padding: 12px;
        color: var(--muted);
      }
      @media (max-width: 900px) {
        .container {
          grid-template-columns: 1fr;
        }
      }
      nav {
        background: #4f46e5;
        padding: 12px;
        position: sticky;
        top: 0;
        text-align: center;
        width: 100%;
      }

      nav a {
        color: white;
        text-decoration: none;
        margin: 0 15px;
        font-size: 14px;
        font-weight: bold;
      }

      nav a:hover {
        text-decoration: underline;
      }

      nav button {
        margin: 5px 5 px;
        background-color: rgb(255, 255, 255);
        border: none;
        padding: 9px 90px;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }

      nav button a {
        text-decoration: none;
        color: rgb(0, 0, 0);
        font-weight: bold;
      }

      nav button:hover {
        background-color: #ffffff00;
        transform: translateY(-1px);
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Latihan Acak Pohon</h1>
      <div class="small" style="font-size: 13px">
        Jawab 3 soal acak setiap kali regenerate
      </div>
    </header>

    <nav
      style="
        background: #4f46e5;
        padding: 10px;
        text-align: center;
        width: 100%;
      "
    >
      <button class="btn secondary" onclick="loadTree()">
        Regenerate & Visualisasi Pohon üå≥
      </button>
    </nav>

    <div class="container">
      <!-- PANEL INPUT -->
      <aside class="panel">
        <h2>Input Pohon (Adjacency List)</h2>
        <textarea id="adjInput">
A:B,C
B:D,E
C:F,G
D:
E:
F:
G:</textarea
        >

        <label>Pilih Akar Pohon:</label>
        <select id="rootSelect"></select>

        <button class="btn" onclick="loadTree()">Visualisasi Pohon</button>

        <div id="soalContainer"></div>

        <button class="btn" onclick="cekJawaban()">Periksa Jawaban ‚úÖ</button>
        <div id="score" class="result" style="margin-top: 10px"></div>
      </aside>

      <!-- PANEL VISUALISASI -->
      <main class="panel">
        <div id="svgWrap">
          <svg
            id="svg"
            viewBox="0 0 800 400"
            preserveAspectRatio="xMidYMid meet"
          ></svg>
        </div>
      </main>
    </div>

    <footer>¬© 2025 ‚Äî Latihan Pohon m-ary</footer>

    <script>
      /* ========== DATA GLOBAL ========== */
      let map, tree, props, rootId;

      /* ========== PARSE ADJ LIST ========== */
      function parseAdj(text) {
        const lines = text
          .split(/\r?\n/)
          .map((l) => l.trim())
          .filter(Boolean);
        const m = new Map();
        for (const line of lines) {
          const [node, chr] = line.split(":");
          const children = (chr || "")
            .split(",")
            .map((s) => s.trim())
            .filter(Boolean);
          m.set(node, children);
        }
        for (const children of m.values())
          for (const c of children) if (!m.has(c)) m.set(c, []);
        return m;
      }

      /* ========== BUILD TREE OBJECT DARI ROOT ========== */
      function buildTree(root) {
        const nodes = new Map();
        for (const k of map.keys()) nodes.set(k, { id: k, children: [] });
        for (const [k, children] of map.entries())
          for (const c of children)
            if (nodes.has(k) && nodes.has(c))
              nodes.get(k).children.push(nodes.get(c));
        return nodes.get(root) || null;
      }

      /* ========== COMPUTE PROPS ========== */
      function computeProps(root) {
        let n = 0,
          e = 0,
          leaves = 0,
          depth = 0;
        function dfs(u, d) {
          if (!u) return;
          n++;
          depth = Math.max(depth, d);
          if (!u.children.length) leaves++;
          for (const v of u.children) {
            e++;
            dfs(v, d + 1);
          }
        }
        dfs(root, 0);
        return { n, e, leaves, depth };
      }

      /* ========== RELATIONSHIP HELPERS ========== */
      function getParent(x) {
        for (const [p, cs] of map.entries()) if (cs.includes(x)) return p;
        return null;
      }
      function getSiblings(x) {
        const p = getParent(x);
        if (!p) return [];
        return map.get(p).filter((c) => c !== x);
      }
      function getCousins(x) {
        const p = getParent(x);
        if (!p) return [];
        const gp = getParent(p);
        if (!gp) return [];
        const au = map.get(gp).filter((c) => c !== p);
        const co = [];
        for (const a of au) co.push(...map.get(a));
        return co.filter((c) => c !== x);
      }
      function getLeaves() {
        return [...map.keys()].filter((k) => map.get(k).length === 0);
      }
      function getAllEdges() {
        const arr = [];
        for (const [p, cs] of map.entries())
          for (const c of cs) arr.push(`${p}-${c}`);
        return arr.join(",");
      }
      function isBalanced(root) {
        const depths = [];
        (function dfs(u, d) {
          if (!u.children.length) depths.push(d);
          else u.children.forEach((v) => dfs(v, d + 1));
        })(root, 0);
        const max = Math.max(...depths),
          min = Math.min(...depths);
        return max - min <= 1;
      }
      function isRegular() {
        const s = new Set();
        for (const cs of map.values()) if (cs.length > 0) s.add(cs.length);
        return s.size <= 1;
      }

      /* ========== LAYOUT & DRAW ========== */
      function layout(root) {
        const nodes = [],
          levelY = 70,
          stepX = 90;
        let leafX = 40;
        (function dfs(u, d) {
          nodes.push(u);
          u._d = d;
          u._y = 30 + d * levelY;
          if (!u.children.length) {
            u._x = leafX;
            leafX += stepX;
          } else {
            u.children.forEach((v) => dfs(v, d + 1));
            u._x = (u.children[0]._x + u.children.at(-1)._x) / 2;
          }
        })(root, 0);
        return nodes;
      }

      function drawTree(root) {
        const svg = document.getElementById("svg");
        svg.innerHTML = "";

        // definisi gradient
        const defs = document.createElementNS(
          "http://www.w3.org/2000/svg",
          "defs"
        );
        const grad = document.createElementNS(
          "http://www.w3.org/2000/svg",
          "linearGradient"
        );
        grad.setAttribute("id", "nodeGrad");
        grad.setAttribute("x1", "0%");
        grad.setAttribute("x2", "0%");
        grad.setAttribute("y1", "0%");
        grad.setAttribute("y2", "100%");
        grad.innerHTML = `<stop offset="0%" stop-color="#0ea5e9"/><stop offset="100%" stop-color="#6366f1"/>`;
        defs.appendChild(grad);
        svg.appendChild(defs);

        const nodes = layout(root);

        // gambar garis link
        for (const n of nodes) {
          for (const c of n.children) {
            const line = document.createElementNS(
              "http://www.w3.org/2000/svg",
              "line"
            );
            line.setAttribute("x1", n._x);
            line.setAttribute("y1", n._y + 16);
            line.setAttribute("x2", c._x);
            line.setAttribute("y2", c._y - 16);
            line.setAttribute("stroke", "#2563eb");
            line.setAttribute("stroke-width", "2");
            svg.appendChild(line);
          }
        }

        // gambar node circle + text
        for (const n of nodes) {
          const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
          const circle = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "circle"
          );

          circle.setAttribute("cx", n._x);
          circle.setAttribute("cy", n._y);
          circle.setAttribute("r", "18");
          circle.setAttribute("fill", "url(#nodeGrad)");
          circle.setAttribute("stroke", "#2563eb");
          circle.setAttribute("stroke-width", "2");

          const text = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "text"
          );
          text.setAttribute("x", n._x);
          text.setAttribute("y", n._y + 5);
          text.setAttribute("text-anchor", "middle");
          text.setAttribute("font-size", "13");
          text.setAttribute("fill", "#fff");
          text.textContent = n.id;

          g.appendChild(circle);
          g.appendChild(text);
          svg.appendChild(g);
        }
      }

      /* ========== GENERATOR 3 SOAL TANPA PREORDER ========== */
      function pickRandomNode() {
        return [...map.keys()][Math.floor(Math.random() * map.size)];
      }

      function buildOneQuestion() {
        const types = [
          "leaf",
          "parent",
          "sibling",
          "cousin",
          "node",
          "edge",
          "depth",
          "alledges",
          "balanced",
          "regular",
        ];
        const t = types[Math.floor(Math.random() * types.length)];
        let q = "",
          a = "";

        if (t === "leaf") {
          q = "Sebutkan semua daun (pisah koma).";
          a = getLeaves().join(",");
        } else if (t === "parent") {
          const x = pickRandomNode();
          q = `Orang tua dari ${x}? (isi: ${x}:Parent).`;
          a = `${x}:${getParent(x) || ""}`;
        } else if (t === "sibling") {
          const x = pickRandomNode();
          q = `Saudara dari ${x}? (${x}:s1).`;
          a = `${x}:${getSiblings(x).join(",")}`;
        } else if (t === "cousin") {
          const x = pickRandomNode();
          q = `Sepupu dari ${x}? (${x}:c1).`;
          a = `${x}:${getCousins(x).join(",")}`;
        } else if (t === "node") {
          q = "Berapa jumlah simpul pada pohon?";
          a = String(props.n);
        } else if (t === "edge") {
          q = "Berapa jumlah sisi pada pohon?";
          a = String(props.e);
        } else if (t === "depth") {
          q = "Berapa kedalaman pohon? (akar=0)";
          a = String(props.depth);
        } else if (t === "alledges") {
          q = "Sebutkan semua edge (pisah koma).";
          a = getAllEdges();
        } else if (t === "balanced") {
          q = "Apakah pohon m-ary seimbang? (ya/tidak)";
          a = isBalanced(tree) ? "ya" : "tidak";
        } else if (t === "regular") {
          q = "Apakah pohon m-ary teratur/regular? (ya/tidak)";
          a = isRegular() ? "ya" : "tidak";
        }

        return { q, a };
      }

      function generateThreeQuestions() {
        const container = document.getElementById("soalContainer");
        container.innerHTML = "";
        for (let i = 0; i < 3; i++) {
          const qa = buildOneQuestion();
          const box = document.createElement("div");
          box.className = "soalBox";
          box.innerHTML = `
      <div><strong>Soal ${i + 1}:</strong> ${qa.q}</div>
      <input class="jawab" placeholder="Ketik jawaban..." />
      <div class="jawabanBenar hiddenBenar"></div>
    `;
          box.dataset.ans = qa.a;
          box.querySelector(".jawabanBenar").dataset.correct = qa.a;
          container.appendChild(box);
        }
      }

      /* ========== LOAD POHON ========== */
      function loadTree() {
        map = parseAdj(document.getElementById("adjInput").value);
        // set root default = key pertama
        rootId = [...map.keys()][0];
        document.getElementById("rootSelect").innerHTML = map.size
          ? [...map.keys()].map((k) => `<option>${k}</option>`).join("")
          : "";
        tree = buildTree(rootId);
        if (!tree) return alert("Pohon gagal dibangun dari akar: " + rootId);

        props = computeProps(tree);
        drawTree(tree);
        generateThreeQuestions();
        generateThreeQuestions();
        generateThreeQuestions();
        generateThreeQuestions();
        // fix: panggil generate 3 soal sekali
        generateThreeQuestions();
        generateThreeQuestions();
        generateThreeQuestions();
        generateThreeQuestions();
        // panggil generator 3 soal
        generateThreeQuestions();
      }

      /* ========== VALIDASI JAWABAN ========== */
      function normalize(s) {
        return String(s || "")
          .trim()
          .toLowerCase()
          .replace(/\s+/g, "");
      }

      function cekJawaban() {
        const boxes = document.querySelectorAll(".soalBox");
        let correct = 0;
        boxes.forEach((box) => {
          const inp = box.querySelector("input");
          const ansDiv =
            inp.nextElementSibling?.nextElementSibling ||
            box.querySelector(".jawabanBenar");
          const student = normalize(inp.value);
          const sys = normalize(box.dataset.ans);
          const ok = student === sys;
          if (ok) correct++;

          const jawabBenar = box.querySelector(".jawabanBenar") || ansDiv;
          if (ok) {
            jawabBenar.textContent = "‚úÖ Benar";
            jawabBenar.className = "jawabanBenar result true";
          } else {
            jawabBenar.textContent =
              "‚ùå Salah ‚Üí Jawaban benar: " + box.dataset.ans;
            jawabBenar.className = "jawabanBenar result false";
          }
        });
        document.getElementById(
          "score"
        ).textContent = `Skor: ${correct}/${boxes.length}`;
      }
    </script>
    <nav>
      <button onclick="location.href='index.html'">Kalkulator Pohon</button>
      <button onclick="location.href='pohonBerakar.html'">
        Materi Pohon Berakar
      </button>
    </nav>
  </body>
</html>
